<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Pipeline An&aacute;lisis transcriptomico usando  Salmon&sol;HISAT2--DESeq2&sol;EdgeR&lowbar;limmavoom</title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="pipeline-análisis-transcriptomico-usando--salmonhisat2--deseq2edger_limmavoom">Pipeline Análisis transcriptomico usando  Salmon/HISAT2--DESeq2/EdgeR_limmavoom</h1>
<p>Por: Esteban Velásquez Agudelo</p>
<p>Este documento es una guía diseñada especificamente para plataformas linux o en su defecto para servidores con arquitectura linux para hacer un analisis transcriptomico de genes dieferencialmente transcritos con los programas mas utilizados y con mayor recomendación por parte de los expertos en 2020 [<a href="#7.-referencias">1</a>]. Estos softwares y los paquetes pueden cambiar como lo ha hecho recientemente DESeq2 con el reciente lfcshrink [<a href="#7.-referencias">2</a>], por tanto siempre es bueno leer nuevas reviews sobre el tema. En este caso todo es hecho en Ubuntu 18.04. se podria tambien utilizar cufflinks pero tophat esta deprecado y cuffdiff no funciona con Salmon por lo cual no es muy recomendable, sin embargo si se quiere usar hay una gran guía aquí <a href="#6.-footnotes">^9</a>.</p>
<h1 id="metodología-de-análisis">Metodología de análisis</h1>
<p>Un analisis transcriptomico en general consta de 5 pasos ilustrados en la Figura 1, los cuales en rasgos generales son:</p>
<ol>
<li>Análisis de la calidad de los datos y filtro de los mismos</li>
<li>Alineamiento de los datos, ya sea contra un genoma de referencia o un transcriptoma de refrencia <a href="#6.-footnotes">^1</a>.</li>
<li>Análisis de expresion diferencial a partir de la cuantificación del</li>
<li>Analisis ontologico y de rutas de los genes</li>
</ol>
<p align="center">
  <img width="460" height="300" src=TRANSCRIPTOMICANALYSIS.svg>
  <p align="center"> Figura 1. Metodología de un analisis transcriptómico<p>
</p>
<h1 id="indice">Indice</h1>
<!-- TOC depthFrom:1 depthTo:6 updateOnSave:false-->
<p><a href="#para-principiantes">Para principiantes</a><br> <a href="#1-an%C3%A1lisis-de-calidad-de-los-datos-y-filtrado">1. Análisis de calidad de los datos y filtrado</a><br></p>
<ul>
<li><a href="#11-an%C3%A1lisis-de-calidad">1.1 Análisis de calidad:</a><br></li>
<li><a href="#12-filtrado-y-remocion-de-adaptadores-con-trimmomatic">1.2 filtrado y remocion de adaptadores con trimmomatic</a><br></li>
</ul>
<p><a href="#2-alineamientto-de-los-reads-filtrados">2. Alineamientto de los reads filtrados</a><br></p>
<ul>
<li><a href="#21-alineamientto-de-los-reads-filtrados-a-un-genoma-de-referencia-usando-hisat2">2.1 Alineamientto de los reads filtrados a un genoma de referencia usando HISAT2</a><br></li>
<li><a href="#22-alineamiento-con-salmon">2.2 Alineamiento con Salmon</a></li>
</ul>
<p><a href="#3-analisis-diferencial-transcripcional">3. Análisis diferencial transcripcional</a></p>
<ul>
<li><a href="#31-instalando-y-preparando-rstudio">3.1 Instalando y preparando rstudio</a></li>
<li><a href="#32-an%C3%A1lisis-utilizando-deseq2-a-partir-de-hisat2con-feature-counts">3.2 Análisis utilizando DESeq2 a partir de HISAT2 con feature counts</a></li>
<li><a href="#33-an%C3%A1lisis-%C3%BAtilizando-deseq2-a-partir-de-salmon">3.3 Análisis útilizando DESeq2 a partir de salmon</a></li>
<li><a href="#34-analisis-%C3%BAtilizando-limma-a-partir-de-featurecounts">3.4 Analisis útilizando limma a partir de featurecounts</a></li>
<li><a href="#35-an%C3%A1lisis-utilizando-limma-a-partir-de-salmon">3.5 Análisis utilizando limma a partir de Salmon</a></li>
</ul>
<p><a href="#analisis-posterior">4. Análisis posterior</a></p>
<ul>
<li>
<p><a href="#41-obtener-el-archivo-de-los-go-terms-y-los-fasta">4.1 Obtener el archivo de los GO terms y los fasta</a></p>
</li>
<li>
<p><a href="#42-graficas-en-R-de-los-go-terms">4.2 Graficas en R de los GO terms</a></p>
</li>
<li>
<p><a href="#43-an%C3%A1lisis-de-conjunto-de-genes-diferencialmente-transcritos-utilizando-el-test-de-fisher">4.3 Análisis de conjunto de genes diferencialmente transcritos utilizando el test de Fisher</a></p>
</li>
<li>
<p><a href="#44-analisis-de-las-rutas-diferencialmente-expresadas-utilizando-keeg-kaas">4.4 Analisis de las rutas diferencialmente expresadas utilizando KEEG-KAAS</a>)</p>
</li>
</ul>
<p><a href="#5-opcionales">5. Opcionales</a></p>
<ul>
<li>
<p><a href="#51-hacer-un-conteo-con-ht-seq">5.1 Hacer un conteo con HT-Seq</a></p>
</li>
<li>
<p><a href="#52-generar-un-archivo-gtf-a-partir-de-un-gff">5.2 Generar un archivo gtf a partir de un gff</a></p>
</li>
<li>
<p><a href="#53-cambiar-el-formato-de-unos-reads-con-biopython">5.3 Cambiar el formato de unos reads con biopython</a></p>
</li>
<li>
<p><a href="#54-para-cambiar-los-permisos-dentro-de-una-carpeta">5.4 Para cambiar los permisos dentro de una carpeta</a></p>
</li>
<li>
<p><a href="#55-para-hacer-una-reconstrucci%C3%B3n-de-un-transcriptoma-de-novo">5.5 Para hacer una recontrucción de un transcriptoma de novo</a></p>
</li>
</ul>
<p><a href="#6.-footnotes">6. Footnotes</a>.</p>
<!-- /TOC -->
<h1 id="para-principiantes">Para principiantes</h1>
<p>Lo primero es aprender a crear ambientes dentro de linux para ser mas eficientes con el uso de la memoria y que corran rapido los programas. La creacción de ambientes se facilita con la herramienta conda, auqnue tambien se pueden crear ambientes sin el uso de esto, pero por terminos de facilidad se usara siempre Conda.</p>
<ul>
<li>Para instalar Conda se utiliza</li>
</ul>
<pre><code class="language-bash"><div>bash Anaconda-latest-Linux-x86_64.sh
</div></code></pre>
<ul>
<li>con este comando se crean ambientes dentro de conda:</li>
</ul>
<pre><code class="language-bash"><div>conda create -n environment_name -c channel %program to download
</div></code></pre>
<ul>
<li>Con estos dos comandos se activan y se desactivan los ambientes:</li>
</ul>
<pre><code class="language-bash"><div>conda activate environmente_name 
conda deactivate
</div></code></pre>
<p>De resto seria muy bueno que se sepa los comandos basicos para emoverse entre carpetas, editar archivos y copiar archivos en linux</p>
<h1 id="1-análisis-de-calidad-de-los-datos-y-filtrado">1. Análisis de calidad de los datos y filtrado</h1>
<h2 id="11-análisis-de-calidad">1.1 Análisis de calidad:</h2>
<p>Siempre es recomendable hacer un FASTQC de los datos y analizar las graficas de porcentaje de bases a ver si hay adaptadores no incluidos en la carpeta de adaptadores de fastqc, la gráfica de calidad de las bases basada en la posición  y el largo promedio de los datos.</p>
<p>Para crear un ambiente y coorer el comando de fatsqc se hace así, donde P102 son los reads a los que se les va a hacer el fastqc:</p>
<pre><code class="language-bash"><div>conda create -n fastqc fastqc
conda activate fastqc
fastqc -o P102 -t 4 P102.fastq
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=fastqc.png>
  <p align="center"> Figura 2. Metodología de un analisis transcriptómico<p>
</p>
<p>En el caso de ejemplo vemos que se puede filtrar un poco las bases del final de algunos reads, pero tambien hay que ver qu ees lo que queremos al alinear y maximizar eso que queremos, además de quitar los adaptadores, en este caso al ver los reads, las primeras 15 bases siempre eran iguales y correspondian a un adaptador, por tanto hay que filtrar y quitarlos con trimmomatic</p>
<h2 id="12-filtrado-y-remocion-de-adaptadores-con-trimmomatic">1.2 filtrado y remocion de adaptadores con trimmomatic</h2>
<p>Se debe descargar la versión binaria y  descomprimirla y pasar el archivo .jar a la carpeta donde estan las reads, se puede descargar de aquí:<a href="http://www.usadellab.org/cms/?page=trimmomatic">http://www.usadellab.org/cms/?page=trimmomatic</a></p>
<p>Comandos para filtrar los datos y quitar adaptadores, donde el primero es para Single reads y el segundo para Paired reads, y la opción para quitar los adaptadores es HEADCROP (Se debe tomar en cuenta que lo que se vario en este caso fue el último nuero de slidingwindow para maximizar la cantidad de reads alineadas únicamente a un gen, las otras opciiones no fueron casi sensibles):</p>
<pre><code class="language-bash"><div>java -jar trimmomatic-0.39.jar SE -phred33 -threads 8 P101T.fastq P101Trim.fastq LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36 HEADCROP:15

java -jar trimmomatic-0.39.jar PE -phred33 -threads 8 P101_F.fastq P101_R.fastq%(acá es necesario poner primero el forward y despues el reverse)% P101_forward_Paired P101_forward_Unpairedtrim.fq P101_reverse_Pairedtrim.fq  P101_forward_Unpairedtrim.fq LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINlEN:36 HEADCROP:15
</div></code></pre>
<h1 id="2-alineamientto-de-los-reads-filtrados">2. Alineamientto de los reads filtrados</h1>
<h2 id="21-alineamientto-de-los-reads-filtrados-a-un-genoma-de-referencia-usando-hisat2">2.1 Alineamientto de los reads filtrados a un genoma de referencia usando HISAT2</h2>
<p>HISAT2 es la mejor herramienta junto con STAR para alinear a un genoma, aunque gaste una buena cantidad de memoria y tiempo. Primero se debe crear el ambiente de HISAT2,luego se debe crear el indice al cual alinear, posterioremente se debe hacer el alineamiento odnde en el ejemplo el primero es para single reads y el segundo para paired reads.</p>
<pre><code class="language-bash"><div>conda create -n hisat hisat2

hisat2-build TriTrypDB-46_TcruziSylvioX10-1_Genome.fasta Tcruzi

hisat2 -q -p 8 -x Tcruzi -U P101T.fastq -S P101T.sam

hisat2 -q -p 8 -x Tcruzi -1 P101T_F.fastq -2 P101T_R -U P101T_Unpaired.fastq -S P101TP.sam

</div></code></pre>
<h3 id="211-cambio-formato-sam-a-bam">2.1.1 Cambio formato sam a bam</h3>
<p>Volver los archivos formato BAM y crear los indices para el archivo, utilizando el programa samtools</p>
<pre><code class="language-bash"><div>conda create -n samtools samtools

samtools sort -@ 8 -o P101T12.bam P101Trim12.sam
 
samtools index ./P101/P101T12.bam

</div></code></pre>
<p><strong>Output</strong> de HISAT2:</p>
<pre><code><code><div>134810 reads; of these:&lt;p&gt;
  134810 (100.00%) were unpaired; of these:&lt;p&gt;
    58794 (43.61%) aligned 0 times&lt;p&gt;
    44963 (33.35%) aligned exactly 1 time&lt;p&gt;
    31053 (23.03%) aligned &gt;1 times&lt;p&gt;
56.39% overall alignment rate&lt;p&gt;
</div></code></code></pre>
<p>Donde lo importante son la cantidad de aligned exactly one time para el caso de <em>T. cruzi </em> en el que el genoma es muy repetitivo. Por lo que se debe variar el sliding length o el trailing o leading para ver cuando se maximizan en general los alineamientos.</p>
<h2 id="22-alineamiento-con-salmon">2.2 Alineamiento con Salmon</h2>
<p>Salmon es la herramienta mas utilizada y preferida para hacer el alineamiento y el conteo de los datos ya que es la que menos tiempo consume y alinea respecto al transcriptoma [<a href="#7.-referencias">3</a>]. Tiene dos posibles desventajas las cuales son un mal analisis diferencial para RNA poco expresado y para pequeños RNA [<a href="#7.-referencias">4</a>]. Para usar la última verison de salmon que es es la mejor en este caso  se debe descargar la version binari y descomprimirlo en la carpeta donde se van a hacer los análisis a los reads de aquí: <a href="https://github.com/COMBINE-lab/salmon/releases/tag/v1.3.0">https://github.com/COMBINE-lab/salmon/releases/tag/v1.3.0</a> y seguir los siguientes pasos:</p>
<ul>
<li>descomprimir la carpeta:</li>
</ul>
<pre><code class="language-bash"><div>tar xzvf salmon-1.2.0_linux_x86_64.tar.gz
</div></code></pre>
<ul>
<li>Crear el decoy : (<a href="https://combine-lab.github.io/alevin-tutorial/2019/selective-alignment/">https://combine-lab.github.io/alevin-tutorial/2019/selective-alignment/</a>)<a href="#6.-footnotes">^2</a></li>
</ul>
<pre><code class="language-bash"><div>grep <span class="hljs-string">&quot;^&gt;&quot;</span> &lt;TriTrypDB-46_TcruziSylvioX10-1_Genome.fasta | cut -d <span class="hljs-string">&quot; &quot;</span> -f 1 &gt; decoys.txt
sed -i.bak -e <span class="hljs-string">&#x27;s/&gt;//g&#x27;</span> decoys.txt
cat TriTrypDB-48_TcruziSylvioX10-1_AnnotatedTranscripts.fasta TriTrypDB-46_TcruziSylvioX10-1_Genome.fasta &gt; gentrome.fasta

</div></code></pre>
<ul>
<li>Crear un indice</li>
</ul>
<pre><code class="language-bash"><div>./salmon-late_linux_x86_64/bin/salmon index -t gentrome.fasta -d decoys.txt -p 8 -i salmon_index --gencode
</div></code></pre>
<ul>
<li>Cuantificar los datos para single reads y el segundo paired reads:</li>
</ul>
<pre><code class="language-bash"><div>./salmon-latest_linux_x86_64/bin/salmon quant -i salmon_index -l A -r ./P101/fastqs/P101T12.fastq --validateMappings -o transcripts_quantP101

./salmon-latest_linux_x86_64/bin/salmon quant -i transcripts_index -l A -1 P101_1.fq -2 P101_2.fq --validateMappings -o transcripts_quantP101

</div></code></pre>
<p>Ya se pasa dierctamente a R para hacer un análisis con DESeq2 o EdgeR-limmavoom</p>
<h1 id="3-analisis-diferencial-transcripcional">3. Analisis diferencial transcripcional</h1>
<h2 id="31-instalando-y-preparando-rstudio">3.1 Instalando y preparando rstudio</h2>
<p>Todo esto se hace en R, en este caso se hizo en la versión 4.0 de R. esto se consigue de la forma:</p>
<pre><code class="language-bash"><div>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9

sudo add-apt-repository <span class="hljs-string">&#x27;deb https://cloud.r-project.org/bin/linux/ubuntu bionic-cran40/&#x27;</span>

sudo apt update

sudo apt install r-base
</div></code></pre>
<ul>
<li>Ahora para instalar r studio se debe bajar el rstudio correspondiente a la distribución en la página:<a href="https://rstudio.com/products/rstudio/download/#download">https://rstudio.com/products/rstudio/download/#download</a></li>
</ul>
<pre><code class="language-bash"><div>sudo apt install gdebi-core

sudo gdebi  rstudio-1.3.1093-amd64.deb
</div></code></pre>
<p>Por Ultimo se deben instalar algunas librerias necesarias para algunos paquetes a nuestra distribución:</p>
<pre><code class="language-bash"><div>sudo apt-get install libcurl4-gnutls-dev
sudo apt-get install libxml2-dev
sudo apt-get install libssl-dev
</div></code></pre>
<p>Es recomendable abrir rstudio desde la terminal como root con sudo. Para instalar paquetes dentro de rstudio se hace así:</p>
<pre><code class="language-r"><div><span class="hljs-keyword">if</span> (!requireNamespace(<span class="hljs-string">&quot;BiocManager&quot;</span>, quietly = <span class="hljs-literal">TRUE</span>))
    install.packages(<span class="hljs-string">&quot;BiocManager&quot;</span>)

BiocManager::install(<span class="hljs-string">&quot;Rsubread&quot;</span>)
</div></code></pre>
<h2 id="32-análisis-utilizando-deseq2-a-partir-de-hisat2-con-feature-counts">3.2 Análisis utilizando DESeq2 a partir de HiSAT2 con feature counts</h2>
<p>En R lo primero que hay que hacer es cuentificar el mappeo de los reads al genoma lo cual se hace con featurecounts() dentro de R, ya que es la mas rápida y la que requiere de menos pasos. Para instalarlo se instala el paquete de Rsubread como se menciono anteriormente.</p>
<h3 id="321-cuantificación-de-mapeo">3.2.1 cuantificación de mapeo</h3>
<p>El comando es el siguiente, donde hay que tener cuidado con el feature type que es el nombre del gen que queremos guardar, se puede inspeccionar el gtf y donde este el nombre TcYSYL_0000001 es generalmente el nombre que buscamos y el nombre de la columna que debemos poner, y el último comando es para verificar que si lo hicimos bien:</p>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(Rsubread)

fc &lt;- featureCounts(files=c(<span class="hljs-string">&quot;./P101/P101T12.bam&quot;</span>, <span class="hljs-string">&quot;./P102/P102T12.bam&quot;</span>, <span class="hljs-string">&quot;./RCl3/RCl3T12.bam&quot;</span>, <span class="hljs-string">&quot;./RCL4/RCl4T12.bam&quot;</span>,<span class="hljs-string">&quot;./RL11/RL11T12.bam&quot;</span>,<span class="hljs-string">&quot;./RL12/RL12T12.bam&quot;</span>),nthreads=<span class="hljs-number">6</span>,annot.ext=<span class="hljs-string">&quot;TriTrypDB-46_TcruziSylvioX10-1.gff&quot;</span>,isGTFAnnotationFile=<span class="hljs-literal">TRUE</span>,GTF.featureType=<span class="hljs-string">&quot;exon&quot;</span>,GTF.attrType=<span class="hljs-string">&quot;ID&quot;</span>)

head(fc$counts)
</div></code></pre>
<p><strong>Output</strong>:</p>
<pre><code><code><div>                      P101T12.bam P102T12.bam RCl3T12.bam RCl4T12.bam RL11T12.bam RL12T12.bam
exon_TcSYL_0117800-E1           1           0           7           1           3           3
exon_TcSYL_0014440-E1           0           0           0           0           1           0
exon_TcSYL_0077180-E1           1           0           3           0           1           2
exon_TcSYL_0058970-E1           0           1           0           0           0           1
exon_TcSYL_0058900-E1           0           0           0           0           1           0
exon_TcSYL_0045600-E1           0           0           0           0           1           0
</div></code></code></pre>
<h3 id="322-importando-los-featurecounts-counts-a-deseq2">3.2.2 Importando los featurecounts counts a DESeq2</h3>
<ul>
<li>Esta guía esta basada en otras guías entre ellas la mejor según opinion propia y del propio creador es <a href="#6.-footnotes">^8</a>.</li>
</ul>
<h4 id="3221-para-crear-un-vector-resuminedo-las-condiciones-se-usa">3.2.2.1 Para crear un vector resuminedo las condiciones se usa:</h4>
<p>En este caso son 4 experimentos artifiales y 2 experimentos naturales, hay que verificar que el orden de la condición es el mismo de las de fc con el último comando, esto se hace de la siguiente forma<a href="#6.-footnotes">^3</a>:</p>
<pre><code class="language-r"><div>condition&lt;-c(rep(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-number">4</span>),<span class="hljs-string">&quot;Natural&quot;</span>,<span class="hljs-string">&quot;Natural&quot;</span>)
coldata &lt;- matrix(c(rep(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-number">4</span>),<span class="hljs-string">&quot;Natural&quot;</span>,<span class="hljs-string">&quot;Natural&quot;</span>), dimnames = list(colnames(fc$counts), <span class="hljs-string">&#x27;condition&#x27;</span>))


coldata
</div></code></pre>
<p><strong>Output</strong>:</p>
<pre><code><code><div>            condition   
P101T12.bam &quot;Artificial&quot;
P102T12.bam &quot;Artificial&quot;
RCl3T12.bam &quot;Artificial&quot;
RCl4T12.bam &quot;Artificial&quot;
RL11T12.bam &quot;Natural&quot;   
RL12T12.bam &quot;Natural&quot;   
</div></code></code></pre>
<h4 id="3222--para-importar-se-usa-el-siguinete-comando">3.2.2.2  Para importar se usa el siguinete comando:</h4>
<p>Para guardar la información de los genes se usan los comandos del segundo parrafo de los comandos y para revisar si se hizo bien se usa el último comando</p>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(<span class="hljs-string">&quot;DESeq2&quot;</span>)

dds &lt;- DESeqDataSetFromMatrix(countData=fc$counts, colData=coldata(fc$counts), design=~condition)


featureData &lt;- data.frame(gene=rownames(fc))
mcols(dds) &lt;- DataFrame(mcols(dds), featureData)
mcols(dds)

colData(dds)
</div></code></pre>
<p><strong>Output</strong>:</p>
<pre><code class="language-r"><div>             condition
              &lt;factor&gt;
P101T12.bam Artificial
P102T12.bam Artificial
RCl3T12.bam Artificial
RCl4T12.bam Artificial
RL11T12.bam Natural   
RL12T12.bam Natural  
</div></code></pre>
<h3 id="323-generando-una-análisis-diferencial-transcripcional">3.2.3 generando una análisis diferencial transcripcional</h3>
<p>Los pasos a seguir generalmente son:</p>
<h4 id="3231-agregar-los-factores-bien">3.2.3.1. Agregar los factores bien</h4>
<pre><code class="language-r"><div>colData(dds)$condition &lt;- factor(colData(dds)$condition, levels=c(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-string">&quot;Natural&quot;</span>))

dds$condition &lt;- relevel(dds$condition, ref = <span class="hljs-string">&quot;Artificial&quot;</span>)
</div></code></pre>
<h4 id="3232-previsualizar-los-datos">3.2.3.2. Previsualizar los datos</h4>
<p>los colores son el numero de experimentos</p>
<pre><code class="language-r"><div>boxplot(log10(counts(dds)+<span class="hljs-number">1</span>),col=c(<span class="hljs-string">&quot;red&quot;</span>,<span class="hljs-string">&quot;green&quot;</span>,<span class="hljs-string">&quot;blue&quot;</span>,<span class="hljs-string">&quot;yellow&quot;</span>,<span class="hljs-string">&#x27;brown&#x27;</span>,<span class="hljs-string">&#x27;gray&#x27;</span>),las=<span class="hljs-number">2</span>)
title(main=<span class="hljs-string">&quot;Unnormalized data and library size DEseq2&quot;</span>, ylab=<span class="hljs-string">&quot;Log-counts&quot;</span>) 
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=unnormDESeq2.png>
  <p align="center"> Figura 3. Previsualización de los datos con DESeq2<p>
</p>
<h4 id="3233-tranformar-los-datos-par-avisulizarlos-en-un-pca">3.2.3.3. Tranformar los datos par avisulizarlos en un PCA:</h4>
<p>Cuando se esperan muchas diferencias la opción de blind debe ser FALSE</p>
<pre><code class="language-r"><div>rld &lt;- rlogTransformation(dds, blind = <span class="hljs-literal">TRUE</span>)
plotPCA(rld, intgroup = c(<span class="hljs-string">&quot;condition&quot;</span>))
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=PCADESeq2.png>
  <p align="center"> Figura 4. PCA DESeq2 <p>
</p>
<h4 id="3234-estimar-la-varianza-biológica">3.2.3.4. Estimar la varianza biológica</h4>
<p>para ver diferentes fitTypes, ya sea local o parametric y ver que tantos datos cogen se puede cambiar el modelo añadiendo fitType='local' con una coma en estimateDispersion <a href="#6.-footnotes">^7</a>.</p>
<pre><code class="language-r"><div>dds &lt;- estimateSizeFactors(dds)
dds &lt;- estimateDispersions(dds)
plotDispEsts(dds)
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=dispDESeq2.png>
  <p align="center"> Figura 5. Dispersion DESeq2 <p>
</p>
<h4 id="3235-determinar-la-transcripción-diferencial-aca-se-puede-variar-el-fittype-pero-hay-que-tener-mucho-cuidado-el-default-es-parametric-y-es-el-recomendable-pero-depende-de-la-dispersión">3.2.3.5. Determinar la transcripción diferencial, aca se puede variar el Fittype pero hay que tener mucho cuidado, el default es parametric y es el recomendable pero depende de la dispersión</h4>
<pre><code class="language-r"><div>dds&lt;-estimateSizeFactors(dds)
dds &lt;- estimateDispersions(dds,fitType=<span class="hljs-string">&#x27;local&#x27;</span>)
dds &lt;-nbinomWaldTest(dds)
res &lt;- results(dds, contrast = c(<span class="hljs-string">&#x27;condition&#x27;</span>, <span class="hljs-string">&#x27;Natural&#x27;</span>, <span class="hljs-string">&#x27;Artificial&#x27;</span>),alpha=<span class="hljs-number">0.05</span>)
summary(res)
</div></code></pre>
<p><strong>Output</strong>:</p>
<pre><code><code><div>out of 16240 with nonzero total read count
adjusted p-value &lt; 0.05
LFC &gt; 0 (up)       : 1, 0.0062%
LFC &lt; 0 (down)     : 39, 0.24%
outliers [1]       : 2, 0.012%
low counts [2]     : 13657, 84%
(mean count &lt; 4)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results
</div></code></code></pre>
<h4 id="3236-quitar-el-efecto-del-tamaño-del-sampleo">3.2.3.6. Quitar el efecto del tamaño del sampleo:</h4>
<p>Acá se puede utilizar una hipotesis distinta a la hipotesis nula  con cierto cambio de expresion<a href="#6.-footnotes">^4</a></p>
<pre><code class="language-r"><div>coefi&lt;-resultsNames(dds)
lfcutoff&lt;-<span class="hljs-number">0.5</span>
res.lfc2 &lt;- lfcShrink(dds, coef=coefi[<span class="hljs-number">2</span>], type=<span class="hljs-string">&quot;apeglm&quot;</span>,res=res) 
res&lt;-res.lfc2
summary(res.lfc2)
</div></code></pre>
<p><strong>Output</strong>:</p>
<pre><code><code><div>out of 16240 with nonzero total read count
adjusted p-value &lt; 0.05
LFC &gt; 0 (up)       : 1, 0.0062%
LFC &lt; 0 (down)     : 39, 0.24%
outliers [1]       : 2, 0.012%
low counts [2]     : 13657, 84%
(mean count &lt; 4)
[1] see 'cooksCutoff' argument of ?results
[2] see 'independentFiltering' argument of ?results
</div></code></code></pre>
<h4 id="3237-gráficar-los-resultados-en-un-plot-ma-con-elefecto-del-sampleo-y-sin-respectivamente">3.2.3.7. Gráficar los resultados en un plot MA con elefecto del sampleo y sin respectivamente:</h4>
<p>PAra efectos de publicación se puede utilizar solo una de las gráficas</p>
<pre><code class="language-r"><div>par(mfrow=c(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))
lims &lt;- c(-<span class="hljs-number">8</span>,<span class="hljs-number">8</span>)
xlab &lt;- <span class="hljs-string">&quot;mean of normalized counts&quot;</span>
plotMA(res.lfc2, ylim=c(-<span class="hljs-number">2</span>,<span class="hljs-number">2</span>), main=<span class="hljs-string">&quot;apeglm, LFC NaturalvsArtificial&quot;</span>, alpha=<span class="hljs-number">0.05</span>)
hline()
plotMA(dds,ylim=c(-<span class="hljs-number">2</span>,<span class="hljs-number">2</span>),main=<span class="hljs-string">&quot;DESeq2&quot;</span>)
hline()
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=MADESeq2.png>
  <p align="center"> Figura 6. Dispersion DESeq2 <p>
</p>
<h4 id="3238-gráficar-los-datos-en-un-reporte-interactivo-para-mayor-análisis">3.2.3.8. Gráficar los datos en un reporte interactivo para mayor análisis:</h4>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(<span class="hljs-string">&quot;Glimma&quot;</span>)
status &lt;- as.numeric(res$padj &lt; <span class="hljs-number">.1</span>)
anno &lt;- data.frame(GeneID=rownames(res), symbol=res$padj)
glMDPlot(res, status=status, counts=counts(dds,normalized=<span class="hljs-literal">TRUE</span>), groups=dds$condition, transform=<span class="hljs-literal">FALSE</span>, samples=colnames(dds), anno, folder=<span class="hljs-string">&quot;glimma&quot;</span>, launch=<span class="hljs-literal">TRUE</span>)
</div></code></pre>
<h4 id="3239-crear-una-lista-de-los-genes-diferencialmente-transcritos-positiva-y-negativamente">3.2.3.9. Crear una lista de los genes diferencialmente transcritos positiva y negativamente:</h4>
<p>Se obtinene las listas de los negativa y positivamente y se iguala la nomenclattura para tritryp de la forma TcYSyl_0000001</p>
<pre><code class="language-r"><div>df&lt;-data.frame(res)
DOWN&lt;-which(df$padj&lt;<span class="hljs-number">0.05</span>  &amp; df$log2FoldChange&lt;<span class="hljs-number">0</span> )
UP&lt;-which(df$padj&lt;<span class="hljs-number">0.05</span>  &amp; df$log2FoldChange&gt;<span class="hljs-number">0</span> )
DEDOWN&lt;-rownames(df[DOWN,])
DEUP&lt;-rownames(df[UP,])


Nomgenes &lt;- <span class="hljs-keyword">function</span>(DEDOWN) {
  <span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(DEDOWN)){
    DEDOWN[i]&lt;-paste(<span class="hljs-string">&quot;TcSYL_&quot;</span>,sub(sprintf(<span class="hljs-string">&quot;.*%s(.*)%s.*&quot;</span>,<span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>), <span class="hljs-string">&quot;\\1&quot;</span>, DEDOWN[i]))
  }
  <span class="hljs-keyword">return</span>(DEDOWN)
}
trimgenes &lt;- <span class="hljs-keyword">function</span>(DOWNshrink) {
  <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(DOWNshrink)){
    DOWNshrink[i]&lt;-gsub(<span class="hljs-string">&quot; &quot;</span> ,<span class="hljs-string">&quot;&quot;</span>,DOWNshrink[i])
  }
  <span class="hljs-keyword">return</span>(DOWNshrink)
}

DEDOWN&lt;-trimgenes(Nomgenes(DEDOWN))
DEUP&lt;-trimgenes(Nomgenes(DEUP))


write(paste(DEDOWN, collapse = <span class="hljs-string">&#x27;,&#x27;</span>), <span class="hljs-string">&#x27;DESeq2.DEGdownlocal.results.txt&#x27;</span>) 
write(paste(DEUP, collapse = <span class="hljs-string">&#x27;,&#x27;</span>), <span class="hljs-string">&#x27;DESeq2.DEGuplocal.results.txt&#x27;</span>)
</div></code></pre>
<h2 id="33-análisis-utilizando-deseq2-a-partir-de-salmon">3.3 Análisis utilizando DESeq2 a partir de Salmon</h2>
<h3 id="331-creando-un-matriz-de-gen-transcripto">3.3.1 creando un matriz de gen-transcripto</h3>
<p>Es mejor tener el .gtf en la misma carpeta donde se va a hacer el analisis y se tiene el script, y los paquetes se instalan como antes se menciono:</p>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(tximport)
<span class="hljs-keyword">library</span>(<span class="hljs-string">&quot;readr&quot;</span>)
<span class="hljs-keyword">library</span>(<span class="hljs-string">&quot;tximportData&quot;</span>)
<span class="hljs-keyword">library</span>(GenomicFeatures)
txdb &lt;- makeTxDbFromGFF(<span class="hljs-string">&quot;TriTrypDB-46_TcruziSylvioX10-1.gtf&quot;</span>)
k &lt;- keys(txdb, keytype = <span class="hljs-string">&quot;GENEID&quot;</span>)
tx2gene &lt;- select(txdb, keys = k, keytype = <span class="hljs-string">&quot;GENEID&quot;</span>, columns = <span class="hljs-string">&quot;TXNAME&quot;</span>)
</div></code></pre>
<h3 id="332-crear-una-matríz-del-diseño-experimental">3.3.2 Crear una matríz del diseño experimental</h3>
<p>Para crearla y verificar que todos los archivos existen, al final debe salir TRUE de la siguinete forma:</p>
<pre><code class="language-r"><div>vv &lt;- c(<span class="hljs-string">&quot;transcripts_quantP101&quot;</span>, <span class="hljs-string">&quot;transcripts_quantP102&quot;</span>, <span class="hljs-string">&quot;transcripts_quantRCl3&quot;</span>, <span class="hljs-string">&quot;transcripts_quantRCl4&quot;</span>,<span class="hljs-string">&quot;transcripts_quantRL11&quot;</span>,<span class="hljs-string">&quot;transcripts_quantRL12&quot;</span>,rep(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-number">4</span>),<span class="hljs-string">&quot;Natural&quot;</span>,<span class="hljs-string">&quot;Natural&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)
samples &lt;- matrix(vv,nrow= <span class="hljs-number">6</span>, ncol = <span class="hljs-number">3</span>, byrow = <span class="hljs-literal">FALSE</span>)
colnames(samples) &lt;- c(<span class="hljs-string">&quot;sample&quot;</span>,<span class="hljs-string">&quot;Resistance&quot;</span>,<span class="hljs-string">&quot;Experiment&quot;</span>)
samples&lt;-data.frame(samples)
samples$condition &lt;- factor(c(rep(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-number">4</span>),rep(<span class="hljs-string">&#x27;Natural&#x27;</span>,<span class="hljs-number">2</span>)))
files &lt;- file.path(<span class="hljs-string">&quot;.&quot;</span>, samples$sample, <span class="hljs-string">&quot;quant.sf&quot;</span>)
names(files) &lt;- paste0(samples$sample)
all(file.exists(files)

</div></code></pre>
<h3 id="332-importando-los-archivos-de-salmon">3.3.2 Importando los archivos de salmon</h3>
<pre><code class="language-r"><div>txi &lt;- tximport(files, type = <span class="hljs-string">&quot;salmon&quot;</span>, tx2gene = tx2gene, ignoreTxVersion = <span class="hljs-literal">TRUE</span>)
names(txi)
<span class="hljs-keyword">library</span>(DESeq2)
condition &lt;- factor(c(rep(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-number">4</span>),rep(<span class="hljs-string">&#x27;Natural&#x27;</span>,<span class="hljs-number">2</span>)))
dds &lt;- DESeqDataSetFromTximport(txi, samples, ~condition)
</div></code></pre>
<p>Ya se sigue igual que a partir de <a href="#3.2.3.1.-agregar-los-factores-bien">3.2.3.1</a></p>
<h2 id="34-análisis-utilizando-limma-a-partir-de-featurecounts">3.4 Análisis utilizando limma a partir de featurecounts</h2>
<h3 id="341-cuantificando-utilizando-feature-counts">3.4.1 Cuantificando utilizando feature counts:</h3>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(Rsubread)
fc &lt;- featureCounts(files=c(<span class="hljs-string">&quot;./P101/P101T12.bam&quot;</span>, <span class="hljs-string">&quot;./P102/P102T12.bam&quot;</span>, <span class="hljs-string">&quot;./RCl3/RCl3T12.bam&quot;</span>, <span class="hljs-string">&quot;./RCL4/RCl4T12.bam&quot;</span>,<span class="hljs-string">&quot;./RL11/RL11T12.bam&quot;</span>,<span class="hljs-string">&quot;./RL12/RL12T12.bam&quot;</span>),nthreads=<span class="hljs-number">8</span>,annot.ext=<span class="hljs-string">&quot;TriTrypDB-46_TcruziSylvioX10-1.gff&quot;</span>,isGTFAnnotationFile=<span class="hljs-literal">TRUE</span>,GTF.featureType=<span class="hljs-string">&quot;exon&quot;</span>,GTF.attrType=<span class="hljs-string">&quot;ID&quot;</span>)
head(fc$counts)
</div></code></pre>
<h3 id="342-crear-un-dge-object-a-partir-de-feature-counts">3.4.2 Crear un DGE object a partir de feature counts</h3>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(edgeR)
x &lt;- DGEList(counts=fc$counts, genes=fc$annotation[,c(<span class="hljs-string">&quot;GeneID&quot;</span>,<span class="hljs-string">&quot;Length&quot;</span>)])
</div></code></pre>
<h3 id="343-previsualizar-los-datos">3.4.3 Previsualizar los datos</h3>
<pre><code class="language-r"><div>lcpm &lt;- cpm(x, log=<span class="hljs-literal">TRUE</span>)
boxplot(lcpm, las=<span class="hljs-number">2</span>,main=<span class="hljs-string">&quot;&quot;</span>,col=c(<span class="hljs-string">&quot;red&quot;</span>,<span class="hljs-string">&quot;green&quot;</span>,<span class="hljs-string">&quot;blue&quot;</span>,<span class="hljs-string">&quot;brown&quot;</span>,<span class="hljs-string">&quot;yellow&quot;</span>,<span class="hljs-string">&quot;gray&quot;</span>))
title(main=<span class="hljs-string">&quot;Unnormalized data and library size&quot;</span>, ylab=<span class="hljs-string">&quot;Log-cpm&quot;</span>)
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=boxplotlimma.png>
  <p align="center"> Figura 7. Previsualización de los datos con Limma<p>
</p>
<h3 id="344-filtrar-los-datos">3.4.4 Filtrar los datos</h3>
<pre><code class="language-r"><div>isexpr &lt;- rowSums(cpm(x) &gt; <span class="hljs-number">10</span>) &gt;= <span class="hljs-number">2</span>
x &lt;- x[isexpr,]
</div></code></pre>
<h3 id="345-normalizando-los-datos-con-tmm">3.4.5 Normalizando los datos con TMM</h3>
<pre><code class="language-r"><div>x2 &lt;- calcNormFactors(x, method = <span class="hljs-string">&quot;TMM&quot;</span>)
lcpm2 &lt;- cpm(x2, log=<span class="hljs-literal">TRUE</span>)
boxplot(lcpm2, las=<span class="hljs-number">2</span>,main=<span class="hljs-string">&quot;&quot;</span>,col=c(<span class="hljs-string">&quot;red&quot;</span>,<span class="hljs-string">&quot;green&quot;</span>,<span class="hljs-string">&quot;blue&quot;</span>,<span class="hljs-string">&quot;brown&quot;</span>,<span class="hljs-string">&quot;yellow&quot;</span>,<span class="hljs-string">&quot;gray&quot;</span>))
title(main=<span class="hljs-string">&quot;Normalised data&quot;</span>, ylab=<span class="hljs-string">&quot;Log-cpm&quot;</span>)

</div></code></pre>
<p align="center">
  <img width="460" height="300" src=boxplotnormlimma.png>
  <p align="center"> Figura 8. Visualización de los datos normalizados con Limma<p>
</p>
<h3 id="346-creando-una-matríz-de-diseño">3.4.6 Creando una matríz de diseño</h3>
<pre><code class="language-r"><div>vv &lt;- c(<span class="hljs-string">&quot;P101&quot;</span>, <span class="hljs-string">&quot;P102&quot;</span>, <span class="hljs-string">&quot;RCl3&quot;</span>, <span class="hljs-string">&quot;RCl4&quot;</span>,<span class="hljs-string">&quot;RL11&quot;</span>,<span class="hljs-string">&quot;RL12&quot;</span>,rep(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-number">4</span>),<span class="hljs-string">&quot;Natural&quot;</span>,<span class="hljs-string">&quot;Natural&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)
targets &lt;- matrix(vv,nrow= <span class="hljs-number">6</span>, ncol = <span class="hljs-number">3</span>, byrow = <span class="hljs-literal">FALSE</span>)
colnames(targets) &lt;- c(<span class="hljs-string">&quot;Filename&quot;</span>,<span class="hljs-string">&quot;Resistance&quot;</span>,<span class="hljs-string">&quot;experiment&quot;</span>)
celltype &lt;- factor(targets[,<span class="hljs-number">2</span>])
design &lt;- model.matrix(~<span class="hljs-number">0</span>+celltype)
colnames(design) &lt;- levels(celltype)
</div></code></pre>
<h3 id="347-normalización-basada-en-voom">3.4.7 Normalización basada en voom</h3>
<pre><code class="language-r"><div>y1&lt;- voom(x2,design,plot=<span class="hljs-literal">TRUE</span>)
</div></code></pre>
<h3 id="348-clusterización-con-pca">3.4.8 Clusterización con PCA</h3>
<pre><code class="language-r"><div>opar &lt;- par(no.readonly = <span class="hljs-literal">TRUE</span>)
par(xpd = <span class="hljs-literal">TRUE</span>, mar = par()$mar + c(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>))
plotMDS(y1,xlim=c(-<span class="hljs-number">2.5</span>,<span class="hljs-number">3</span>),labels = c(<span class="hljs-string">&quot;P101&quot;</span>, <span class="hljs-string">&quot;P102&quot;</span>, <span class="hljs-string">&quot;RCl3&quot;</span>, <span class="hljs-string">&quot;RCl4&quot;</span>,<span class="hljs-string">&quot;RL11&quot;</span>,<span class="hljs-string">&quot;RL12&quot;</span>),col=c(rep(<span class="hljs-string">&quot;green&quot;</span>,<span class="hljs-number">4</span>),<span class="hljs-string">&quot;red&quot;</span>,<span class="hljs-string">&quot;red&quot;</span>))
legend(par(<span class="hljs-string">&quot;usr&quot;</span>)[<span class="hljs-number">2</span>], par(<span class="hljs-string">&quot;usr&quot;</span>)[<span class="hljs-number">4</span>], c(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-string">&quot;Natural&quot;</span>), pch = <span class="hljs-number">16</span>, col = c(<span class="hljs-string">&quot;green&quot;</span>,<span class="hljs-string">&quot;red&quot;</span>), bty = <span class="hljs-string">&quot;n&quot;</span>)
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=PCAfilter.png>
  <p align="center"> Figura 9. PCA con Limma<p>
</p>
<h3 id="349-aplicando-el-modelo-lineal-para-la-transcripción-diferencial">3.4.9 Aplicando el modelo lineal para la transcripción diferencial:</h3>
<br>
En este caso se usa la opción de Trend y Robust. Robust filtra los genes con una varianza muy distinta a la promedio y el trend se usa cuando la diferencia del tamaño de las liberias mas grande y mas pequeña es menor 3 veces
<pre><code class="language-r"><div>fit1 &lt;- lmFit(y1,design)
contr &lt;- makeContrasts(ArtificialvsNatural=Artificial-Natural,levels=design)
fit1.contr &lt;- eBayes(contrasts.fit(fit1,contr),trend = <span class="hljs-literal">TRUE</span>,robust = <span class="hljs-literal">TRUE</span>) 
dt1 &lt;- decideTests(fit1.contr)
summary(dt1)
</div></code></pre>
<h3 id="3410-comparacion-de-los-modelos">3.4.10 Comparacion de los modelos:</h3>
<p>Ahora se comparan las dispersiones de los distintos modelos donde se corre el comando de <a href="#3.4.9-aplicando-el-modelo-lineal-para-transcripci%C3%B3n-diferencial">3.4.9</a> colocando el robust y el Trend como false acada uno independientemente y se mira las diferencias de cuales cogen mas datos y si el robust filtra mucho los datos, procediendo a decidir cual utilizar.</p>
<pre><code class="language-r"><div>plotSA(fit1.contr)
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=SAplot.png>
  <p align="center"> Figura 10. Plot de dispersión con Limma con trend y robust<p>
</p>
<h3 id="3411-visualizar-los-datos-en-un-maplot-o-en-un-glimma">3.4.11 Visualizar los datos en un MAplot o en un glimma</h3>
<p>El MA es ara publicación y el glimma para un reporte y para análisis posteriores.</p>
<pre><code class="language-r"><div>tfit1 &lt;- treat(fit1, lfc=<span class="hljs-number">1</span>)
plotMD(tfit1, column=<span class="hljs-number">1</span>, status=dt1[,<span class="hljs-number">1</span>], main=colnames(tfit1)[<span class="hljs-number">1</span>], xlim=c(<span class="hljs-number">0</span>,<span class="hljs-number">15</span>),ylim=c(<span class="hljs-number">0</span>,<span class="hljs-number">12</span>))
<span class="hljs-keyword">library</span>(Glimma)
glMDPlot(tfit1, coef=<span class="hljs-number">1</span>, status=dt, main=colnames(tfit1)[<span class="hljs-number">1</span>],side.main=<span class="hljs-string">&quot;ENTREZID&quot;</span>, counts=lcpm, groups=celltype, launch=<span class="hljs-literal">FALSE</span>)
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=MAplotlimma.png>
  <p align="center"> Figura 11. MAPlot de Limma con trend y robust<p>
</p>
<h3 id="3412-crear-archivos-de-salida">3.4.12 Crear archivos de salida</h3>
<p>Guardar los datos de los genes dieferenciales en una lista para análisis Go y de rutas. Esta aproximación es un poco burda por lo que pueden simplificarlo con funciones.</p>
<h4 id="34121-se-crea-una-tabala-con-los-genes-diferencalmente-transcritos">3.4.12.1 Se crea una tabala con los genes Diferencalmente transcritos</h4>
<pre><code class="language-r"><div>voom.tt &lt;- topTable(fit1.contr, adjust.method = <span class="hljs-string">&quot;BH&quot;</span>,number= <span class="hljs-literal">Inf</span>)
voom.limma.results &lt;- data.frame(gene.id = rownames(voom.tt), p.value = voom.tt$P.Value, q.value = voom.tt$adj.P.Val, log.fc = voom.tt$logFC, test.stat = voom.tt$t, row.names = <span class="hljs-literal">NULL</span>)
</div></code></pre>
<h4 id="34122-se-seleccionan-los-genes-regulados-positiva-y-negativamente">3.4.12.2 se seleccionan los genes regulados positiva y negativamente</h4>
<pre><code class="language-r"><div>De.limma.down&lt;- which(dt1[,<span class="hljs-number">1</span>]==-<span class="hljs-number">1</span>)
De.limma.up&lt;-which(dt1[,<span class="hljs-number">1</span>]==<span class="hljs-number">1</span>)
de.limma.down=c()
<span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> De.limma.down){
  de.limma.down&lt;-c(de.limma.down, dimnames(dt1[i,<span class="hljs-number">0</span>])[[<span class="hljs-number">1</span>]])
}
de.limma.down
de.limma.up=c()
<span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> De.limma.up){
  de.limma.up&lt;-c(de.limma.up, dimnames(dt1[i,<span class="hljs-number">0</span>])[[<span class="hljs-number">1</span>]])
}
de.limma.up
position&lt;-voom.limma.results$q.value&lt;<span class="hljs-number">0.05</span>
DEgenesdown&lt;-c()
</div></code></pre>
<h4 id="34123-cambo-de-formato-a-tritryp">3.4.12.3 cambo de formato a TriTryp</h4>
<p>se buscan los nombres solamente de los genes en el formato de trytryp quitando los espacios vacios en el segundo loop tanto para los regulados positiva y negativamente</p>
<pre><code class="language-r"><div><span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(position)){
  <span class="hljs-keyword">if</span>(position[i]==<span class="hljs-literal">TRUE</span> &amp; voom.limma.results$gene.id[i] %<span class="hljs-keyword">in</span>% de.limma.down){
    DEgenesdown &lt;- c(DEgenesdown, trimws(paste(<span class="hljs-string">&quot;TcSYL_&quot;</span>,sub(sprintf(<span class="hljs-string">&quot;.*%s(.*)%s.*&quot;</span>,<span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>), <span class="hljs-string">&quot;\\1&quot;</span>, voom.limma.results$gene.id[i]))))
  }
}
DEgenedown=c()
<span class="hljs-keyword">for</span> (x <span class="hljs-keyword">in</span> DEgenesdown){
  DEgenedown&lt;-c(DEgenedown, gsub(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>, x, fixed = <span class="hljs-literal">TRUE</span>))
}
DEgenesup&lt;-c()
<span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(position)){
  <span class="hljs-keyword">if</span>(position[i]==<span class="hljs-literal">TRUE</span> &amp; voom.limma.results$gene.id[i] %<span class="hljs-keyword">in</span>% de.limma.up){
    DEgenesup &lt;- c(DEgenesup, trimws(paste(<span class="hljs-string">&quot;TcSYL_&quot;</span>,sub(sprintf(<span class="hljs-string">&quot;.*%s(.*)%s.*&quot;</span>,<span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>), <span class="hljs-string">&quot;\\1&quot;</span>, voom.limma.results$gene.id[i]))))
  }
}
DEgeneup=c()
<span class="hljs-keyword">for</span> (x <span class="hljs-keyword">in</span> DEgenesup){
  DEgeneup&lt;-c(DEgeneup, gsub(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>, x, fixed = <span class="hljs-literal">TRUE</span>))
}
</div></code></pre>
<h4 id="34124-verificación-y-escritura">3.4.12.4 verificación y escritura</h4>
<p>Se verifica que se haya hecho bien y se guardan en un txt</p>
<pre><code class="language-r"><div>DEgeneup
DEgenedown 
write(paste(DEgenedown, collapse = <span class="hljs-string">&#x27;,&#x27;</span>), <span class="hljs-string">&#x27;limma.DEGdown.results.txt&#x27;</span>)
write(paste(DEgeneup, collapse = <span class="hljs-string">&#x27;,&#x27;</span>), <span class="hljs-string">&#x27;limma.DEGup.results.txt&#x27;</span>)
</div></code></pre>
<h2 id="35-análisis-utilizando-limma-a-partir-de-salmon">3.5 Análisis utilizando limma a partir de Salmon</h2>
<p>Se crea una matríz con los pares transcritos-genes de la misma forma que en DESeq2 en el punto <a href="#3.3.1-creando-un-matriz-de-gen-transcripto">3.3.1</a></p>
<h3 id="352-importando-los-datos-para-crar-un-dge-object">3.5.2 Importando los datos para crar un DGE object:</h3>
<pre><code class="language-r"><div>txi &lt;- tximport(files, type = <span class="hljs-string">&quot;salmon&quot;</span>, tx2gene = tx2gene, ignoreTxVersion = <span class="hljs-literal">TRUE</span>, countsFromAbundance = <span class="hljs-string">&quot;lengthScaledTPM&quot;</span>)
<span class="hljs-keyword">library</span>(limma)
<span class="hljs-keyword">library</span>(edgeR)
y &lt;- DGEList(txi$counts)
</div></code></pre>
<h3 id="353-filtrar-los-datos-y-creación-de-una-condición-y-normalizarlos">3.5.3 Filtrar los datos y creación de una condición y normalizarlos</h3>
<pre><code class="language-r"><div>isexpr &lt;- rowSums(cpm(y) &gt; <span class="hljs-number">5</span>) &gt;= <span class="hljs-number">4</span>
y &lt;- y[isexpr,]
condition &lt;- factor(c(rep(<span class="hljs-string">&quot;Artificial&quot;</span>,<span class="hljs-number">4</span>),rep(<span class="hljs-string">&#x27;Natural&#x27;</span>,<span class="hljs-number">2</span>)))
y &lt;- calcNormFactors(y,method = <span class="hljs-string">&quot;TMM&quot;</span>)
lcpm2 &lt;- cpm(y, log=<span class="hljs-literal">TRUE</span>)
boxplot(lcpm2, las=<span class="hljs-number">2</span>,main=<span class="hljs-string">&quot;&quot;</span>,col=c(<span class="hljs-string">&quot;red&quot;</span>,<span class="hljs-string">&quot;green&quot;</span>,<span class="hljs-string">&quot;blue&quot;</span>,<span class="hljs-string">&quot;brown&quot;</span>,<span class="hljs-string">&quot;yellow&quot;</span>,<span class="hljs-string">&quot;gray&quot;</span>))
title(main=<span class="hljs-string">&quot;Normalised data&quot;</span>, ylab=<span class="hljs-string">&quot;Log-cpm&quot;</span>)
y &lt;- voom(y, design)

</div></code></pre>
<p align="center">
  <img width="460" height="300" src=normalizedcounts.png>
  <p align="center"> Figura 12. Boxplot normalizada de salmon en limma<p>
</p>
<p>Ya se siguen los mismos pasos que desde <a href="#3.4.8-clusterizacion-con-pca">3.4.8</a> con una pequeña diferencia al final (<a href="#3.4.12-crear-archivos-de-salida">3.4.12</a>) ya que estan los nombres de los transcritos y no de los genes:</p>
<pre><code class="language-r"><div>DEgenesdown &lt;- c(DEgenesdown,substr(voom.limma.results$gene.id[i],<span class="hljs-number">1</span>,nchar(voom.limma.results$gene.id[i])-<span class="hljs-number">3</span>))
</div></code></pre>
<h1 id="4-análisis-posterior">4. Análisis posterior</h1>
<h2 id="41--obtener-el-archivo-de-los-go-terms-y-los-fasta-de-los-genes-diferencialmente-transcritos">4.1  Obtener el archivo de los GO terms y los fasta de los genes diferencialmente transcritos.</h2>
<p>Hay que entrar al sitio :<a href="https://tritrypdb.org/tritrypdb/app/">https://tritrypdb.org/tritrypdb/app/</a> luego en el cuadro de <strong>Search for</strong>  y luego en se da click en <strong>Genes</strong>, luego <strong>Annotation, curaton and identifiers</strong> y por último seleccionar <strong>Gene ID</strong> . Ya en esta ventana se le da en <strong>upload a text file</strong>  se nombra la busqueda y se le da <strong>Get Answer</strong>. Posterioremente se le da en el cuadro de Download<a href="#6.-footnotes">^5</a>. <br>
En este cuadro se selecciona  dependiendo del análisis:</p>
<h3 id="411-para-el-análisis-ontológico-se-debe">4.1.1 Para el análisis ontológico se debe:</h3>
<p>Se debe dar check en: <strong>Tab- or comma-delimited (openable in Excel) - choose a pre-configured table</strong>. Luego seleccionar en <strong>function prediction y GO Terms</strong>. Tambien se debe seleccionar <strong>Comma-delimited (.csv) file</strong> y ya darle en <strong>Get</strong>.</p>
<h3 id="412-para-el-análisis-de-rutas-metabolicas-es">4.1.2 Para el análisis de rutas metabolicas es:</h3>
<p>Se debe tenr un archivo fasta de los genes regulados trancripcionalmente y se hace de la forma check en <strong>FASTA - sequence retrieval, configurable</strong>. Luego seleccinar <strong>Protein</strong>, luego <strong>Text File</strong> y luego <strong>Get Sequences</strong>.</p>
<h2 id="42-gráficas-en-r-de-los-go-terms">4.2. Gráficas en R de los GO terms</h2>
<p>Una vez tenemos todos los .csv procedemos a hacer unas pequeñas gráficas para resumir un poco los resultados en r de la siguiente forma:</p>
<h3 id="421-leer-los-datos-de-un-archivo-csv-en-la-misma-carpeta-que-el-script-a-usar">4.2.1 Leer los datos de un archivo csv en la misma carpeta que el script a usar</h3>
<pre><code class="language-r"><div>DOWNDEG&lt;-read.csv(<span class="hljs-string">&quot;./salmonDeseqresults/SalmonDESeq2down.csv&quot;</span>)
</div></code></pre>
<h3 id="422-graficó-de-pie-de-los-go-terms">4.2.2 Graficó de PIE de los GO terms</h3>
<p>Lso siguientes son códigos para generar pie charts de los porcentaes de cada termino genral ontologico dentro de los genes regulados diferencialmente.</p>
<h4 id="4221-para-los-regulados-negativamente">4.2.2.1 para los regulados negativamente:</h4>
<pre><code class="language-r"><div>BP&lt;-sum(DOWNDEG$Ontology==<span class="hljs-string">&quot;Biological Process&quot;</span>)/length(DOWNDEG$Ontology)
MF&lt;-sum(DOWNDEG$Ontology==<span class="hljs-string">&quot;Molecular Function&quot;</span>)/length(DOWNDEG$Ontology)
CC&lt;-sum(DOWNDEG$Ontology==<span class="hljs-string">&quot;Cellular Component&quot;</span>)/length(DOWNDEG$Ontology)

pie(c(BP,MF,CC),labels=c(paste(round(<span class="hljs-number">100</span>*BP,<span class="hljs-number">2</span>),<span class="hljs-string">&quot;%&quot;</span>),paste(round(<span class="hljs-number">100</span>*MF,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;%&quot;</span>),paste(round(<span class="hljs-number">100</span>*CC,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;%&quot;</span>)),explode=<span class="hljs-number">0.1</span>, main=<span class="hljs-string">&quot;&quot;</span>,col=c(<span class="hljs-string">&quot;blue&quot;</span>, <span class="hljs-string">&quot;lightblue&quot;</span>, <span class="hljs-string">&quot;cyan&quot;</span>))
legend(<span class="hljs-string">&quot;topright&quot;</span>, c(<span class="hljs-string">&quot;Biological Process&quot;</span>,<span class="hljs-string">&quot;Molecular Function&quot;</span>,<span class="hljs-string">&quot;Cellular Component&quot;</span>), cex = <span class="hljs-number">0.56</span>,fill = c(<span class="hljs-string">&quot;blue&quot;</span>, <span class="hljs-string">&quot;lightblue&quot;</span>, <span class="hljs-string">&quot;cyan&quot;</span>),box.lty=<span class="hljs-number">0</span>,inset = <span class="hljs-number">0.062</span>)

</div></code></pre>
<p align="center">
  <img width="460" height="300" src=PieDown.png>
  <p align="center"> Figura 13. Gráfica de pie de los GO terms negativos en salmon por DESeq2<p>
</p>
<h4 id="4221-para-los-regulados-negativamente-1">4.2.2.1 para los regulados negativamente:</h4>
<pre><code class="language-r"><div>UPDEG&lt;-read.csv(<span class="hljs-string">&quot;./salmonDeseqresults/SalmonDESeq2up.csv&quot;</span>)
BP&lt;-sum(UPDEG$Ontology==<span class="hljs-string">&quot;Biological Process&quot;</span>)/length(UPDEG$Ontology)
MF&lt;-sum(UPDEG$Ontology==<span class="hljs-string">&quot;Molecular Function&quot;</span>)/length(UPDEG$Ontology)
CC&lt;-sum(UPDEG$Ontology==<span class="hljs-string">&quot;Cellular Component&quot;</span>)/length(UPDEG$Ontology)
pie(c(BP,MF,CC),labels=c(paste(round(<span class="hljs-number">100</span>*BP,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;%&quot;</span>),paste(round(<span class="hljs-number">100</span>*MF,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;%&quot;</span>),paste(round(<span class="hljs-number">100</span>*CC,<span class="hljs-number">1</span>),<span class="hljs-string">&quot;%&quot;</span>)),explode=<span class="hljs-number">0.1</span>, main=<span class="hljs-string">&quot;&quot;</span>,col=c(<span class="hljs-string">&quot;blue&quot;</span>, <span class="hljs-string">&quot;lightblue&quot;</span>, <span class="hljs-string">&quot;cyan&quot;</span>))
legend(<span class="hljs-string">&quot;topleft&quot;</span>, c(<span class="hljs-string">&quot;Biological Process&quot;</span>,<span class="hljs-string">&quot;Molecular Function&quot;</span>,<span class="hljs-string">&quot;Cellular Component&quot;</span>), cex = <span class="hljs-number">0.58</span>,fill = c(<span class="hljs-string">&quot;blue&quot;</span>, <span class="hljs-string">&quot;lightblue&quot;</span>, <span class="hljs-string">&quot;cyan&quot;</span>),box.lty=<span class="hljs-number">0</span>,inset =  <span class="hljs-number">0.04</span>)

</div></code></pre>
<p align="center">
  <img width="460" height="300" src=PieUp.png>
  <p align="center"> Figura 14. Gráfica de pie de los GO terms positivos en salmon por DESeq2<p>
</p>
<h3 id="423-gráfico-resumido-de-los-principales-términos-ontológicos-dentro-de-los-genes-regulados-positiva-y-negativamente">4.2.3 Gráfico resumido de los principales términos ontológicos dentro de los genes regulados positiva y negativamente:</h3>
<p>Primero se saca los 15 primeros terminas mas mencionados en cada tipo de regulación</p>
<h4 id="4231-para-genes-regulados-negativamente">4.2.3.1 Para genes regulados negativamente:</h4>
<pre><code class="language-r"><div>terms&lt;-unique(DOWNDEG$GO.Term.Name)
counts&lt;-c(rep(<span class="hljs-number">0</span>,length(terms)))
<span class="hljs-keyword">for</span>( i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(terms)){
  <span class="hljs-keyword">for</span>(j <span class="hljs-keyword">in</span> DOWNDEG$GO.Term.Name){
    <span class="hljs-keyword">if</span>(terms[i]==j){
      counts[i]=counts[i]+<span class="hljs-number">1</span>
    }
  }
}
df&lt;-data.frame(counts,terms)
df1 &lt;- df[order(-counts),] 
df1&gt; df[with(df, order(-counts, terms)), ]
df2&lt;-df1[<span class="hljs-number">1</span>:<span class="hljs-number">15</span>,]
</div></code></pre>
<h4 id="4231-para-genes-regulados-positvamente">4.2.3.1 Para genes regulados positvamente</h4>
<p>contamos los diferentes procesos y luego contamos la cantidad de cada uno:</p>
<pre><code class="language-r"><div>termsup&lt;-unique(UPDEG$GO.Term.Name)
countsup&lt;-c(rep(<span class="hljs-number">0</span>,length(termsup)))
<span class="hljs-keyword">for</span>( i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:length(termsup)){
  <span class="hljs-keyword">for</span>(j <span class="hljs-keyword">in</span> UPDEG$GO.Term.Name){
    <span class="hljs-keyword">if</span>(termsup[i]==j){
      countsup[i]=countsup[i]+<span class="hljs-number">1</span>
    }
  }
}
countsup
dfup&lt;-data.frame(countsup,termsup)
df1up &lt;- dfup[order(-countsup),] 
df1up&gt; dfup[with(df, order(-countsup, termsup)), ]
df2up&lt;-df1up[<span class="hljs-number">1</span>:<span class="hljs-number">15</span>,]
</div></code></pre>
<h3 id="424-unión-de-los-dataframes-para-un-solo-gráfico">4.2.4 Unión de los dataframes para un solo gráfico:</h3>
<pre><code class="language-r"><div>names(df2up)&lt;-names(df2)
df2up&lt;-na.omit(df2up)
df2&lt;-na.omit(df2)
df2all&lt;-rbind(df2, df2up)
</div></code></pre>
<h3 id="425-gráfico-de-los-15-primeros-términos-de-cada-regulación">4.2.5 Gráfico de los 15 primeros términos de cada regulación:</h3>
<p><a href="#6.-footnotes">^10</a></p>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(ggplot2)
<span class="hljs-keyword">library</span>(dplyr)
<span class="hljs-keyword">library</span>(forcats)
colors&lt;-c(rep(<span class="hljs-string">&quot;#f68060&quot;</span>,length(df2[,<span class="hljs-number">1</span>])),rep(<span class="hljs-string">&quot;#60d6f6&quot;</span>,length(df2up[,<span class="hljs-number">1</span>])))
rownames(df2all) &lt;- c()
df2all[<span class="hljs-string">&quot;Tgene&quot;</span>]&lt;-c(rep(<span class="hljs-number">1</span>,length(df2[,<span class="hljs-number">1</span>])),rep(<span class="hljs-number">2</span>,length(df2up[,<span class="hljs-number">1</span>])))
df2all[<span class="hljs-string">&quot;Type&quot;</span>]&lt;-c(rep(<span class="hljs-string">&quot;DOWN&quot;</span>,length(df2[,<span class="hljs-number">1</span>])),rep(<span class="hljs-string">&quot;UP&quot;</span>,length(df2up[,<span class="hljs-number">1</span>])))
df2all
df2all %&gt;%
  ggplot( aes(x=reorder(terms,Tgene), y=counts,fill=Type)) +
  geom_bar(stat=<span class="hljs-string">&quot;identity&quot;</span>, alpha=<span class="hljs-number">.8</span>, width=<span class="hljs-number">.5</span>) +
  coord_flip() +
  xlab(<span class="hljs-string">&quot;&quot;</span>) +
  theme_bw()+
  ylab(<span class="hljs-string">&quot;Number of genes&quot;</span>)+
  scale_fill_manual(values = c(<span class="hljs-string">&quot;#f68060&quot;</span>, <span class="hljs-string">&quot;#60d6f6&quot;</span>))
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=Goanalysis.png>
  <p align="center"> Figura 15. Gráfica de los principales Go terms<p>
</p>
<h2 id="43-análisis-de-conjuntos-de-genes-diferencialmente-transcritos-utilizando-el-test-de-fisher">4.3 Análisis de conjuntos de genes diferencialmente transcritos utilizando el test de Fisher.</h2>
<p>Este análisis es útil para cuando hay varios genes diferencialmente expresados &gt;20, generalmente los de limma, para sacar conjuntos de genes que tengan que ver con terminos y ver tanto inglujo tienen en estas clasificaciones</p>
<h3 id="431-enriquecimiento-usando-el-test-de-fisher-utilizando-la-herramienta-de-tritrypdb">4.3.1 Enriquecimiento usando el test de fisher utilizando la herramienta de TriTrypDB</h3>
<ul>
<li>
<p>Se entra a <a href="https://tritrypdb.org/tritrypdb/app/workspace/strategies/214100480/226362170">https://tritrypdb.org/tritrypdb/app/workspace/strategies/214100480/226362170</a> y se selcciona mis estrategias, o se vuelven a realizar los pasos del 4.1. al estar en los resultados le damos en <strong>Analize results</strong> y seleccionamos <strong>Gene ontology Enrichment</strong>.<br></p>
</li>
<li>
<p>Seleccionamos el organismo conn el cual queremos hacer el enriquecimiento con el resto default y seleccionamos <strong>cellular component</strong>, luego le damos en <strong>Download</strong>, para finalizar volvemos a repetir este paso seleccionando las proximas veces <strong>Molecular Function</strong> y <strong>Biological Process</strong> .<a href="#6.-footnotes">^6</a></p>
</li>
</ul>
<h3 id="432-leer-los-datos-sacados-de-tritryp">4.3.2 leer los datos sacados de TriTryp</h3>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(data.table)
CCDOWN&lt;-read.delim(<span class="hljs-string">&quot;./salmonlimmaresults/GoEnrichmentCCDOWNlimma.tab&quot;</span>,header = <span class="hljs-literal">T</span>, sep = <span class="hljs-string">&quot;\t&quot;</span>)
MFDOWN&lt;-read.delim(<span class="hljs-string">&quot;./salmonlimmaresults/GoEnrichmentMFDOWNlimma.tab&quot;</span>,header = <span class="hljs-literal">T</span>, sep = <span class="hljs-string">&quot;\t&quot;</span>)
MFUP&lt;-read.delim(<span class="hljs-string">&quot;./salmonlimmaresults/GoEnrichmentMFUPlimma.tab&quot;</span>,header = <span class="hljs-literal">T</span>, sep = <span class="hljs-string">&quot;\t&quot;</span>)
BPDOWN&lt;-read.delim(<span class="hljs-string">&quot;./salmonlimmaresults/GoEnrichmentBPDOWNlimma.tab&quot;</span>,header = <span class="hljs-literal">T</span>, sep = <span class="hljs-string">&quot;\t&quot;</span>)
BPUP&lt;-read.delim(<span class="hljs-string">&quot;./salmonlimmaresults/GoEnrichmentBPUPlimma.tab&quot;</span>,header = <span class="hljs-literal">T</span>, sep = <span class="hljs-string">&quot;\t&quot;</span>)
</div></code></pre>
<h3 id="432-crar-tablas-con-los-terminos-con-el-menor-p-value">4.3.2 Crar tablas con los terminos con el menor P-value</h3>
<pre><code class="language-r"><div><span class="hljs-keyword">library</span>(gridExtra)
df&lt;-data.frame(CCDOWN$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>],MFDOWN$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>],MFUP$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>],BPDOWN$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>],BPUP$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>])
df1&lt;-data.frame(CCDOWN$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>],MFDOWN$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>])
names(df1)&lt;-c(<span class="hljs-string">&#x27;CCUP&#x27;</span>,<span class="hljs-string">&#x27;MFUP&#x27;</span>)
grid.table(df1)
df2&lt;-data.frame(BPDOWN$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>])
names(df2)&lt;-c(<span class="hljs-string">&#x27;BPUP&#x27;</span>)
grid.table(df2)
df3&lt;-data.frame(MFUP$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>],BPUP$Name[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>])
names(df3)&lt;-c(<span class="hljs-string">&#x27;MFDOWN&#x27;</span>,<span class="hljs-string">&#x27;BPDOWN&#x27;</span>)
grid.table(df3)
</div></code></pre>
<p align="center">
  <img width="460" height="300" src=enrichment.png>
  <p align="center"> Figura 16. Gráfica de los genes enriquecidos<p>
</p>
<h2 id="44-analisis-de-las-rutas-diferencialmente-expresadas-utilizando-keeg-kaas">4.4 Analisis de las rutas diferencialmente expresadas utilizando KEEG-KAAS</h2>
<p>Entrar a la siguiente pagina <a href="https://www.genome.jp/kegg/kaas/">https://www.genome.jp/kegg/kaas/</a> y selccionar la opción de <strong>Partial Genome</strong>. Seleccionar la opción de <strong>GHOSTX</strong> para luego seleccionar mas abajo <strong>File Upload</strong> y ingresar el fasta de la secuencia de aminoacidos descargada en el paso 4.1.2. Posteriormente se le debe dar un nombre único al query e ingresar un correo electronico propio. Para los organismos se debe borrar toda la lista y luego darle click a <strong>Organism List</strong> y luego seleccionar todos los kinetoplastidos en este pop-up, Por último darle <strong>Compute</strong>  y esperamos a que nos llegue la notificación al correo. Cuando llegue la primera notificación debemos darle click al enlace para activar el cómputo, y solo se puede un computo a la vez.</p>
<h3 id="441-análisis-de-los-resultados-de-keeg">4.4.1 Análisis de los resultados de KEEG</h3>
<p>Lo que se debe analizar al obetener los resultados son las prumeras rutas del principio. Tambien se debe analizar  los resultados al darle <strong>Execute</strong> y luego en module y brite las proteinas y partes de las rutas involucradas.</p>
<h1 id="5-opcionales">5. Opcionales:</h1>
<h2 id="51-hacer-un-conteo-con-ht-seq">5.1 Hacer un conteo con HT-seq</h2>
<p>HT-seq es una herramienta para hacer la cuantificación de un archivo BAM con respecto a un genoma de referencia donde se debe descargar el programa y luego utilizarlo con sigle reads y luego con paired reads de la siguiente forma(HT-seq no funciona con alineamientos donde se cuatifican single reads y paired reads al mismo timepo, por loq ue toca separarlos):</p>
<pre><code class="language-bash"><div>conda create -n htseq HTSeq

htseq-count -s no -f bam -n 4 ./ERR3501950/accepted_hits.bam.SE.bam TriTrypDB-46_TcruziSylvioX10-1.gtf &gt; SE_50_count.txt

htseq-count -s no -r name -f bam -n 4 ./ERR3501950/accepted_hits.bam.PE.bam TriTrypDB-46_TcruziSylvioX10-1.gtf &gt; PE_50_counts.txt
</div></code></pre>
<p>       Para separar un archivo bam en bam Single end y Paired end se hace con:</p>
<pre><code class="language-bash"><div>conda activate samtools
samtools view -bf 1 foo.bam &gt; foo.paired-end.bam
samtools view -bF 1 foo.bam &gt; foo.single-end.bam
</div></code></pre>
<h2 id="52-generar-un-archivo-gtf-a-partir-de-un-gff">5.2 Generar un archivo gtf a partir de un gff</h2>
<pre><code class="language-bash"><div>conda create -n agat -c bioconda agat

agat_convert_sp_gff2gtf.pl --gff TriTrypDB-46_TcruziSylvioX10-1.gff -o 1_TriTrypDB-46_TcruziSylvioX10-1.gtf
</div></code></pre>
<h2 id="53-cambiar-el-formato-de-unos-reads-con-biopython">5.3 Cambiar el formato de unos reads con biopython</h2>
<p>Se instala Biopython y luego se corre el siguiente comando</p>
<pre><code class="language-python"><div><span class="hljs-keyword">from</span> Bio <span class="hljs-keyword">import</span> SeqIO
count = SeqIO.convert(<span class="hljs-string">&quot;G5ABAL401.RCl3.sff&quot;</span>, <span class="hljs-string">&quot;sff&quot;</span>, <span class="hljs-string">&quot;RCl3.fastq&quot;</span>, <span class="hljs-string">&quot;fastq&quot;</span>)
</div></code></pre>
<h2 id="54-para-cambiar-los-permisos-dentro-de-una-carpeta">5.4 Para cambiar los permisos dentro de una carpeta</h2>
<p>El comando para habilitarlo al cualquiera es:</p>
<pre><code class="language-bash"><div>sudo chmod -R a+rwX file/
</div></code></pre>
<h2 id="55-para-hacer-una-reconstrucción-de-un-transcriptoma-de-novo">5.5 Para hacer una reconstrucción de un transcriptoma de novo</h2>
<ul>
<li><a href="https://www.rna.uni-jena.de/compared-the-best-de-novo-transcriptome-assembly-tools/">https://www.rna.uni-jena.de/compared-the-best-de-novo-transcriptome-assembly-tools/</a></li>
</ul>
<p>Spades es muy bueno en ensamblar un genoma entonces yo utilizaría este</p>
<h1 id="6-footnotes">6. Footnotes</h1>
<p>[^1] : En algunos casos se hace un ensamble de transcriptoma de novo lo cual implica otros pasos.<br>
[^2] : Para obtener el transcriptoma y el gtf de <em>T. cruzi</em> se unde en data, luego en Download data, current release y se busca la especie que uno va a analizar en <a href="https://tritrypdb.org/tritrypdb/app">https://tritrypdb.org/tritrypdb/app</a> <br>
[^3] Para más informacion de etso visitar <a href="https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#count-matrix-input">https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#count-matrix-input</a> <br>
[^4] Para más información: <a href="https://www.biostars.org/p/293212/">https://www.biostars.org/p/293212/</a> <br>
[^5]Una versión visual tutorial está disponible en: <a href="https://www.youtube.com/watch?v=npgkkychkrI&amp;list=LLUISwaoqeJZF8tvTzj2aX9w&amp;index=1">https://www.youtube.com/watch?v=npgkkychkrI&amp;list=LLUISwaoqeJZF8tvTzj2aX9w&amp;index=1</a> <br>
[^6] Una versión visual tutorial está disponible en: <a href="https://www.youtube.com/watch?v=qGLkAEzQpqU&amp;list=LLUISwaoqeJZF8tvTzj2aX9w&amp;index=3&amp;t=0s">https://www.youtube.com/watch?v=qGLkAEzQpqU&amp;list=LLUISwaoqeJZF8tvTzj2aX9w&amp;index=3&amp;t=0s</a><br>
[^7] Para mayor información de esta discusión <a href="https://support.bioconductor.org/p/81094/">https://support.bioconductor.org/p/81094/</a><br>
[^8] Para una Guía comprimida de DESeq2 está: <a href="https://bioconductor.github.io/BiocWorkshops/rna-seq-data-analysis-with-deseq2.html">https://bioconductor.github.io/BiocWorkshops/rna-seq-data-analysis-with-deseq2.html</a><br>
[^9] Aunque utilizando HISAT2 o STar en vez de Tophat2 Trapnell, C., Roberts, A., Goff, L., Pertea, G., Kim, D., Kelley, D. R., ... &amp; Pachter, L. (2012). Differential gene and transcript expression analysis of RNA-seq experiments with TopHat and Cufflinks. Nature protocols, 7(3), 562-578.
[^10]for colors <a href="https://www.colorhexa.com/f68060">https://www.colorhexa.com/f68060</a></p>
<h1 id="7-referencias">7. Referencias</h1>
<p>[1] Williams, C. R., Baccarella, A., Parrish, J. Z., &amp; Kim, C. C. (2017). Empirical assessment of analysis workflows for differential expression analysis of human samples using RNA-Seq. BMC bioinformatics, 18(1), 38.<br>
[2] Zhu, A., Ibrahim, J. G., &amp; Love, M. I. (2019). Heavy-tailed prior distributions for sequence count data: removing the noise and preserving large differences. Bioinformatics, 35(12), 2084-2092.<br>
[3]<a href="https://cgatoxford.wordpress.com/2016/08/17/why-you-should-stop-using-featurecounts-htseq-or-cufflinks2-and-start-using-kallisto-salmon-or-sailfish/">https://cgatoxford.wordpress.com/2016/08/17/why-you-should-stop-using-featurecounts-htseq-or-cufflinks2-and-start-using-kallisto-salmon-or-sailfish/</a><br>
[4] Yi, L., Liu, L., Melsted, P., &amp; Pachter, L. (2018). A direct comparison of genome alignment and transcriptome pseudoalignment. BioRxiv, 444620.<br>
-Anders, S., Pyl, P. T., &amp; Huber, W. (2015). HTSeq—a Python framework to work with high-throughput sequencing data. Bioinformatics, 31(2), 166-169.<br>
-Andrews S. (2010). FastQC: a quality control tool for high throughput sequence data.<br>
-Aslett, M., Aurrecoechea, C., Berriman, M., Brestelli, J., Brunk, B. P., Carrington, M., ... &amp; Gardner, M. J. (2010). TriTrypDB: a functional genomic resource for the Trypanosomatidae. Nucleic acids research, 38(suppl_1), D457-D462.<br>
-Bolger, A. M., Lohse, M., &amp; Usadel, B. (2014). Trimmomatic: a flexible trimmer for Illumina sequence data. Bioinformatics, 30(15), 2114-2120.<br>
Brian Bushnel. (2016). HISAT2 or Tophat2. Retrieved from <a href="https://www.biostars.org/p/230724/">https://www.biostars.org/p/230724/</a><br>
-Cock, P. J., Antao, T., Chang, J. T., Chapman, B. A., Cox, C. J., Dalke, A., ... &amp; De Hoon, M. J. (2009). Biopython: freely available Python tools for computational molecular biology and bioinformatics. Bioinformatics, 25(11), 1422-1423.<br>
-Cock, P. J., Fields, C. J., Goto, N., Heuer, M. L., &amp; Rice, P. M. (2010). The Sanger FASTQ file format for sequences with quality scores, and the Solexa/Illumina FASTQ variants. Nucleic acids research, 38(6), 1767-1771.<br>
-Cruz-Saavedra, L., Muñoz, M., Patiño, L. H., Vallejo, G. A., Guhl, F., &amp; Ramírez, J. D. (2020). Slight temperature changes cause rapid transcriptomic responses in Trypanosoma cruzi metacyclic trypomastigotes. Parasites &amp; vectors, 13, 1-16.<br>
-Garber, M., Grabherr, M. G., Guttman, M., &amp; Trapnell, C. (2011). Computational methods for transcriptome annotation and quantification using RNA-seq. Nature methods, 8(6), 469-477.<br>
-Kim, D., Langmead, B., &amp; Salzberg, S. L. (2015). HISAT: a fast spliced aligner with low memory requirements. Nature methods, 12(4), 357-360.<br>
-Law, C. W., Chen, Y., Shi, W., &amp; Smyth, G. K. (2014). voom: Precision weights unlock linear model analysis tools for RNA-seq read counts. Genome biology, 15(2), R29.<br>
-Liao, Y., Smyth, G. K., &amp; Shi, W. (2014). featureCounts: an efficient general purpose program for assigning sequence reads to genomic features. Bioinformatics, 30(7), 923-930.<br>
-Love, M. I., Huber, W., &amp; Anders, S. (2014). Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2. Genome biology, 15(12), 550.<br>
-Ma’ayan Avii (2014). The Fisher Exact test, Network Analysis in Systems Biology . Coursera BC : Mount Sinai Center for Bioinformatics. <br>
-Moriya, Y., Itoh, M., Okuda, S., Yoshizawa, A. C., &amp; Kanehisa, M. (2007). KAAS: an automatic genome annotation and pathway reconstruction server. Nucleic acids research, 35(suppl_2), W182-W185.<br>
-Patro, R., Duggal, G., Love, M. I., Irizarry, R. A., &amp; Kingsford, C. (2017). Salmon provides fast and bias-aware quantification of transcript expression. Nature methods, 14(4), 417-419.<br>
-Team, R. C. (2013). R: A language and environment for statistical computing.<br>
-Trapnell, C., Hendrickson, D. G., Sauvageau, M., Goff, L., Rinn, J. L., &amp; Pachter, L. (2013). Differential analysis of gene regulation at transcript resolution with RNA-seq. Nature biotechnology, 31(1), 46-53.</p>

    </body>
    </html>